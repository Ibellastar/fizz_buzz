CLEANUP = rm -rf
BUILD_DIR = ../../checker-output

#We try to detect the OS we are running on, and adjust commands as needed
ifeq ($(OS),Windows_NT)
  ifeq ($(shell uname -s),) # not in a bash-like shell
	CLEANUP = rmdir
  endif
endif


all: clean setup compile test_1 check

clean:
# TODO: Delete all output files that will be generated by the build process
	$(CLEANUP) $(BUILD_DIR)
	rm -rf build

setup:
# TODO: Create actual output directory
	mkdir build
	meson setup $(BUILD_DIR)

compile:
	meson compile -C $(BUILD_DIR)

.PHONY: test_1
test_1:
	gcc -o build/test_1 tests/test_1/main_1.c ../../src/fizz_buzz.c 
	build/test_1 > ../../checker-output/actual_output_1.txt 2>&1

# .PHONY: test_seventeen
# test_seventeen:
# 	gcc -o build/test_seventeen test/main_seventeen.c ../../src/fizz_buzz.c 
# 	build/test_seventeen > test_seventeen_output.txt 2>&1

check:
	meson test -C $(BUILD_DIR) --print-errorlogs -v